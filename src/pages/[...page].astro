---
import { siteConfig } from '@/config';
import CategoryBar from '@components/misc/CategoryBar.astro';
import PostPage from '@components/PostPage.astro';
import ProfileCard from '@components/widgets/ProfileCard.astro';
import SiteInfoCard from '@components/widgets/SiteInfoCard.astro';
import GridLayout from '@layouts/GridLayout.astro';
import { getCategories, getSortedPosts } from '@utils/content-utils';

export async function getStaticPaths() {
  const articles = await getSortedPosts();
  const pageNum = Math.ceil(articles.length / siteConfig.postsPerPage);
  let pages = Array.from({ length: pageNum }).map((_, i) => ({
    params: { page: i + 1 === 1 ? undefined : 'page/' + (i + 1).toString() },
    props: { page: i + 1 },
  }));
  return pages;
}

const { page } = Astro.props;
const articles = await getSortedPosts();
const categories = await getCategories();
---

<GridLayout>
  <CategoryBar categories={categories} />
  <PostPage
    posts={articles}
    currentPage={page}
    baseUrl={`/page`}
    specialPage={[{ page: 1, url: '/' }]}
  />
  <Fragment slot="aside-fixed">
    <ProfileCard />
    <SiteInfoCard />
  </Fragment>
</GridLayout>
