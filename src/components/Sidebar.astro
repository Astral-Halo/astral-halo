---
import { navbarConfig } from '@/config';

import { Icon } from 'astro-icon/components';

import Button from './widgets/Button.astro';
import DarkModeButton from './widgets/DarkModeButton.astro';
---

<div id="sidebar" transition:persist>
  <div
    id="sidebar-mask"
    class="fixed z-40 opacity-0 pointer-events-none w-full h-full bg-black/10 backdrop-blur-md backdrop-saturate-100 duration-500 ease-in-out"
  >
  </div>
  <div
    id="sidebar-menu"
    class="fixed h-full z-50 -right-1/3 w-1/3 duration-500 ease-in-out border-l-2 theme-border theme-card-bg"
  >
    <div id="sidebar-site-data"></div>
    <DarkModeButton
      showText={true}
      class="text-lg !w-[calc(100%-1rem)] border-2 theme-border"
    />
    <div id="sidebar-menu-text-items">
      {
        navbarConfig.navbarCenterItems.map((item) => (
          <Button
            id="sidebar-menu-item"
            href={item.href}
            onclick={item.onclick}
            title={item.text}
          >
            <span class="text-xl">{item.text}</span>
          </Button>
        ))
      }
    </div>
    <div id="sidebar-menu-icon-items" class="flex">
      {
        navbarConfig.navbarRightItems.onlyWide.map((item) => (
          <Button
            id="sidebar-menu-item"
            href={item.href}
            onclick={item.onclick}
            title={item.text}
          >
            <Icon name={item.icon} class="text-2xl" />
          </Button>
        ))
      }
    </div>
  </div>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const toggleSidebarBtns = document.getElementById('nav-toggle-sidebar-btn');
    const sidebarMask = document.getElementById('sidebar-mask');
    const sidebarMenu = document.getElementById('sidebar-menu');

    toggleSidebarBtns?.addEventListener('click', () => {
      sidebarMask?.classList.remove('opacity-0');
      sidebarMask?.classList.remove('pointer-events-none');
      sidebarMenu?.classList.add('-translate-x-full');
      sidebarMenu?.removeAttribute('inert');
    });

    sidebarMask?.addEventListener('click', () => {
      sidebarMask?.classList.add('opacity-0');
      sidebarMask?.classList.add('pointer-events-none');
      sidebarMenu?.classList.remove('-translate-x-full');
      sidebarMenu?.setAttribute('inert', 'true');
    });

    window.addEventListener('resize', () => {
      if (window.innerWidth > 768) {
        sidebarMask?.classList.add('opacity-0');
        sidebarMask?.classList.add('pointer-events-none');
        sidebarMenu?.classList.remove('-translate-x-full');
        sidebarMenu?.setAttribute('inert', 'true');
      }
    });
  });
</script>
